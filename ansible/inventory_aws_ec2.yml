plugin: amazon.aws.aws_ec2
regions:
  - ap-southeast-2
filters:
  instance-state-name: running
  # Lọc các EC2 instance theo Tag Name
  "tag:Name":
    - k8s-master-*
    - k8s-worker-*

# Tự động gom nhóm (Grouping)
groups:
  # Nếu tag Name chứa 'master' -> đưa vào group 'masters'
  masters: "'k8s-master' in tags.Name"
  # Nếu tag Name chứa 'worker' -> đưa vào group 'workers'
  workers: "'k8s-worker' in tags.Name"

# Use IP address as hostname (not "public-ip-address" string)
# This ensures each instance gets a unique hostname based on its IP
hostnames:
  - ip-address
  - public-ip-address
  - private-ip-address

# Cấu hình biến kết nối cho từng host
compose:
  # Use public IP for connection
  ansible_host: public_ip_address
  ansible_user: ubuntu
  # SSH key path: deploy.py sẽ tự động update đường dẫn tuyệt đối vào đây
  ansible_ssh_private_key_file: "/home/minhtri/Downloads/practice_RKE2/terraform/k8s-key.pem"
  ansible_ssh_common_args: "-o StrictHostKeyChecking=no"
